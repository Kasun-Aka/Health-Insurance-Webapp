<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Make Payment | Health Insurance Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#2563EB',
                        accent: '#60A5FA',
                        neutral: '#F3F4F6',
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral min-h-screen font-sans text-gray-800">

<!-- HEADER -->
<header class="bg-primary text-white shadow-md px-8 py-4 flex justify-between items-center">
    <h1 class="text-2xl font-semibold tracking-wide">Payment Simulation</h1>
    <form th:action="@{/logout}" method="get">
        <button type="submit"
                class="bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-lg font-medium transition duration-300">
            Logout
        </button>
    </form>
</header>

<!-- MAIN CONTENT -->
<main class="max-w-3xl mx-auto mt-12 bg-white/90 backdrop-blur-lg rounded-2xl shadow-xl p-8">
    <h2 class="text-xl font-semibold text-gray-700 border-b pb-3 mb-6">Make Payment (Simulation)</h2>

    <!-- ✅ Feedback Messages -->
    <div th:if="${success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
        <span th:text="${success}">Payment successful!</span>
    </div>
    <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
        <span th:text="${error}">Something went wrong.</span>
    </div>

    <!-- FORM -->
    <form th:action="@{/payment/process}" method="post" class="space-y-6">
        <input type="hidden" name="policyId" th:value="${policyId}" />

        <!-- Policy Info -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-gray-700">
            <p><strong>Policy:</strong> <span class="text-primary" th:text="${policyName}">Policy Name</span></p>
            <p><strong>Amount to Pay:</strong> <span class="text-secondary font-semibold" th:text="${policyRate}">0.00</span> LKR</p>
        </div>

        <!-- Cardholder Name -->
        <div>
            <label class="block text-gray-700 font-medium mb-1">Cardholder Name</label>
            <input type="text" name="cardHolder" placeholder="Full name on card" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
        </div>

        <!-- Card Number -->
        <div>
            <label class="block text-gray-700 font-medium mb-1">Card Number</label>
            <input type="text" name="cardNumber" placeholder="4242 4242 4242 4242" maxlength="19" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
        </div>

        <!-- Expiry and CVC -->
        <div class="grid grid-cols-2 gap-6">
            <div>
                <label class="block text-gray-700 font-medium mb-1">Expiry (MM/YY)</label>
                <input type="text" name="expiry" placeholder="MM/YY" maxlength="5" required
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
            </div>
            <div>
                <label class="block text-gray-700 font-medium mb-1">CVC</label>
                <input type="text" name="cvc" placeholder="123" maxlength="4" required
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
            </div>
        </div>

        <!-- Read-only Amount -->
        <div>
            <label class="block text-gray-700 font-medium mb-1">Amount (LKR)</label>
            <input type="number" step="0.01" name="amount" th:value="${policyRate}" readonly
                   class="w-full bg-gray-100 border border-gray-300 rounded-lg px-4 py-2 text-gray-700 cursor-not-allowed" />
        </div>

        <!-- Payment Method -->
        <div>
            <label class="block text-gray-700 font-medium mb-1">Payment Method</label>
            <select name="paymentMethod"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <option value="CREDIT_CARD">Credit Card</option>
                <option value="BANK_TRANSFER">Bank Transfer</option>
                <option value="CASH">Cash</option>
            </select>
        </div>

        <!-- Buttons -->
        <div class="flex justify-end gap-4 pt-6">
            <a th:href="@{/policies}"
               class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg font-medium transition duration-300">
                Cancel
            </a>
            <button type="submit"
                    class="bg-secondary hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold shadow-md transition duration-300">
                Pay (Simulate)
            </button>
        </div>
    </form>
</main>

<!-- FOOTER -->
<footer class="text-center text-gray-500 text-sm mt-16 pb-6">
    <p>© 2025 <span class="font-semibold text-primary">Health Insurance Portal</span>. All rights reserved.</p>
</footer>

<!-- JS: Card Formatting -->
<script>
    const cardNumber = document.querySelector('input[name="cardNumber"]');
    cardNumber && cardNumber.addEventListener('input', e => {
        const v = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
        const groups = v.match(/.{1,4}/g);
        e.target.value = groups ? groups.join(' ') : v;
    });

    const expiry = document.querySelector('input[name="expiry"]');
    expiry && expiry.addEventListener('input', e => {
        let v = e.target.value.replace(/[^0-9]/g, '').slice(0,4);
        if (v.length >= 3) v = v.slice(0,2) + '/' + v.slice(2);
        e.target.value = v;
    });
</script>
</body>
</html>
